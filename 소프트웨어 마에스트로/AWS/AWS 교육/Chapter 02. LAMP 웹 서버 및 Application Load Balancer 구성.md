- LAMP
	- 리눅스 기반의 가상 서버에 아파치 웹 서버, MySQL 데이터베이스, PHP 어플리케이션을 구성하는 것을 LAMP라고 한다.
- 목표
	- 클라우드 네트워크 환경에 LAMP 웹 서버를 구성하고, Application Load Balancer를 추가해 이중화된 네트워크를 구성한다..
	- 다음과 같은 서비스를 사용해 이러한 서버를 구현할 수 있다.
		- Amazon VPC (VPC, Subnet, Internet Gateway, ...)
		- Amazon EC2
		- Amazon EBS
		- Amazon EFS
		- Elastic Load Balancer - Application Load Balancer
	- 웹서버뿐만 아니라, 웹서버를 운영하기 위한 네트워크 환경도 구성하기 때문에 사용하는 서비스가 많다.
	- 스토리지 서버 2개를 사용하게 되고, 블록 스토리지 EBS와 파일 스토리지 EFS를 사용하게 된다.
	- 이중화 네트워크를 구성하고, 트래픽을 분산하기 위한 Elastic Load Balancer 사용된다.
- 다음과 같이 아키텍처가 구성되게 된다.
	- public subnet이 외부 인터넷과 직접적으로 통신하게 된다.
		- EC2 인스턴스가 구성되어 있고, EC2는 인터넷 게이트웨이를 통해 외부와 통신이 가능하다.
		- 인스턴스에 LAMP 스택을 포함하여 필요한 소프트웨어 패키지를 설치하면 웹서버로 활용 가능하다.
	- private subnet은 외부 인터넷과 직접적인 통신이 제한되어 있다.
	- EFS는 VPC 안에 위치하게 된다.
		- 각 서브넷에 마운트 타겟을 통해 EC2 인스턴스와 연결되고, 파일을 저장하고, 공유할 수 있게 된다.
	- 웹서버는 퍼블릭 서브넷에 위치해도 기능 수행에 문제가 없지만, 외부 인터넷과 직접적인 통신이 가능하기 때문에 보안적인 측면에서는 적절하지 않다.
		- private subnet에 위치하는데, 이 경우 보안적인 측면에서 개선될 수 있지만, 외부망과의 연결이 제한되어 있기 때문에 유지보수 / 업데이트의 작업을 위해 인스턴스에 직접 접속하기 어렵다.
			- public subnet에 위치한 instance를 이용해서 private subnet으로 접근해야 한다.
				- 이러한 중계 서버를 bastion 서버라 한다.
			- private subnet에 위치한 인스턴스는 업데이트나 유지보수 뿐만 아니라, 웹 서버의 기능을 수행하기 위해 외부 인터넷과 통신할 수 있어야 한다.
				- 이때 public subnet에 위치한 NAT Gateway를 이용해 외부 인터넷과 통신한다.
		- 단일 인스턴스만으로도 웹서버를 구성하는것은 문제가 없지만, 실제로 운영되는 웹 서비스는 트래픽 증가, 장애 등과 걑은 다양한 이슈들에 대한 리스크가 존재한다.
			- 이러한 현상을 대비하기 위해 복수개의 웹 서비스를 구성하고, 인스턴스들을 로드 밸런서에 연결하여 사용한다.
			- 여러개의 로드 밸런서 중 어플리케이션 로드 밸런서를 사용할 것이다.
		- private subnet에 위치한 웹서버는 외부와 직접적인 통신이 제한되어 있기 때문에, 동시에 안정적인 아키텍처를 구성할 수 있게 된다.

- 기본 네트워크 환경 구성에서는 서울 리전에 VPC를 만들고, 하위에 서브넷을 만든다.
	- 외부 인터넷과 통신이 가능하도록 인터넷 게이트웨이와 라우트 테이블을 생성한다.
	- 트래픽이 이동할 수 있도록 라우트 테이블에 라우트를 설정한다.

- 이후 EC2를 설정한다.
	- 웹 서버의 동작을 확인하고, 마지막으로 PHP를 호스팅해 LAMP 웹 서버가 정상적으로 동작하는지 확인한다.

- Custom AMI를 통한 Public EC2 인스턴스 생성
	- 아마존 머신 이미지를 커스텀으로 만들고, 해당 AMI를 통해 EC2 인스턴스를 추가로 만든다.
	- 이전 단계에서 생성한 EC2 인스턴스로 아마존 머신 이미지를 생성하고, 이를 이용하여 추가로 생성한다.
	- 생성이 완료되면 웹 브라우저에서 웹서버가 정상적으로 작동하는지 확인한다.

- EFS를 통한 네트워크 파일 시스템 구성
	- 네트워크 파일 시스템을 생성하고, EC2 인스턴스와 연결한다.
	- EFS에 사용할 보안 그룹을 준비하고, EFS를 구성한다
		- 이 과정에서 EFS 구성에 필요한 Availiability, Life cycle, performance 등을 설정하게 된다.
	- EFS 생성이 완료되면, EFS를 EC2 인스턴스에 마운트하고, 웹 브라우저를 통해 네트워크 파일시스템이 잘 구성되었는지 테스트한다.

- 어플리케이션 로드 밸런서를 이용한 이중화 네트워크 구성
	- 로드 밸런서를 이용하여 퍼블릭 서브넷에 생성한 두 인스턴스로 이동하는 네트워크를 이중화로 구성한다.
		- 로드 밸런서의 트래픽을 받을 타겟 집합인 타겟 그룹을 만든다.
			- 타겟 타임, 프로토콜, 포트 등 타겟이 되는 다양한 설정을 한다.
		- 타겟 그룹을 대상으로 하는 어플리케이션 로드 밸런서를 구성한다.
			- 이 과정에서 로드 밸런서의 스키마, 네트워크, 보안 그룹, 리스터, 룰 등이 설정된다.
		- 로드 밸런서 구성이 완료되면 로드밸런서가 정상적으로 작동하는지 테스트를 수행한다.
	- 이후 private subnet을 타겟으로 하는 이중화된 네트워크를 구성해본다.
		- 어플리케이션 로드밸런서 챕터와 마찬가지로 타겟 그룹과 어플리케이션 로드밸런서를 만들고 웹 브라우저를 통해 로드 밸런서 작동 여부를 테스트한다.
		- 

- Bastion host와 NAT Gateway를 통한 Private EC2 인스턴스의 외부 통신 구성
	- 외부와 직접적인 통신이 제한된 private subnet에 EC2를 생성한다.
		- 이 private instance가 외부와 통신이 가능한 환경을 구성한다.
	- private subnet의 EC2 인스턴스를 생성한다.
		- 이후 public subnet 인스턴스를 통해 private subnet에 접속한다.
		- NAT Gateway를 생성하고, 라우트 테이블에 이동 경로를 설정하여 private subnet의 인스턴스가 외부와 통신이 가능한 환경을 만들고, 테스트를 진행한다.