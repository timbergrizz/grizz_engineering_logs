## IPv4
- 우리가 사용하는 주소는 IPv4 주소이다.
	- 32비트로 구성되어 있으며, 1바이트마다 10진법으로 표현하여 처리한다.
- IP주소는 unique하게 존재한다.
	- 사설망 구성할 때 쓰는 주소나 루프백 주소등은 해당되지 않는다.
	- 네트워크는 이렇게 구축된다.
- IPv4는 총 $2^{32} = 4294957296$ 개 존재한다.
	- 약 40억개 존재하고, 보통은 바이너리로 표현을 많이 한다.
- ip 주소는 읽기 편하게 하기 위해서 10진수로 표현한다.
	- 구조 자체는 32비트짜리 하나의 숫자로 이루어져 있다고 생각하면 좋다.
- ip 주소는 1바이트 단위로 끊어서 읽는다.
	- 이 숫자들이 5장에서 자주 보게 될 숫자들이다.
	- 10000000 / 11000000 / 11100000 / 11110000
- binary number와 decimal number간의 변환하는 방법 잘 익혀둬야 한다.
- IP주소의 complement는 255에서 빼면 구해진다.

## Classful Address
- class A에 50%, class B에 25%로 반으로 줄어가면서 클래스가 디자인된다.
	- class D / E는 개수 동일하다. 6.25%
- 클래스는 다음과 같이 구성된다.![[Pasted image 20221027123759.png]]
	- class D는 multicast를 위해 사용하고, class E는 다른 용도로 사용된다.
	- A, B, C를 구분할 수 있어야 한다.
		- 처음 시작비트부터 0이되는 지점을 확인해 클래스를 구분할 수 있다.

## Netid & HostId
- 클래스 구분자까지를 NetID, 그 이후 부분부터 HostID로 읽는다.
	- 일반적으로 네트워크 id 단위로 판매가 이루어진다.
- 클래스 A의 블락은 다음과 같이 구성된다.![[Pasted image 20221027130556.png]]
- 클래스 B의 블락은 다음과 같이 구성된다.![[Pasted image 20221027130651.png]]
	- 네트워크 ID가 조금 더 단위가 작게 구성이 된다.
	- 이후 이를 통해 컴퓨터 / 라우터에 할당할 수 있다.
- class C의 주소는 다음과 같이 구성된다.![[Pasted image 20221027130755.png]]
	- 클래스 C는 3번째 바이트까지 구분자로 사용하게 된다.
	- 클래스 C는 사이즈가 애매하다.
		- 이걸 바이트단위로 끊어서 이렇게 된다.
- 클래스에 따라 블락 사이즈가 달라지게 된다.
	- 하나의 블락에는 서로 다른 개수의 주소가 할당되게 된다.
- 클래스 D는 멀티캐스팅을 위해 사용하고, 잘 안쓰인다.
- 클래스 E는 Reserved이고, 잘 사용되지 않는다.
- 클래스를 통해 다음과 같이 끊어 읽을 수 있어야 한다.![[Pasted image 20221027131135.png]]
	- A : n =8, B : n = 16, C : n = 24

- 모든 ip 주소는 두 단계로 끊어야 한다.
	- 전화번호부는 몇국의 몇번으로 이루어지는지 생각해야 한다.
- network id 하나를 사온다고 생각하면 된다.
	- 클래스에 따라 크기가 달라지게 된다.
	- Host는 클래스 관리자 마음대로 관리한다고 생각하면 된다.
		- 바이트 단위로 끊어 읽게 되고, 말하기 불편하기 때문에 바이트 단위로 10진수로 바꿔서 읽는 것이다.
- 128 -> 10000000 / 192 -> 11000000 / 224 -> 11100000 / 240 -> 111100000
	- 65000개로 한 네트워크를 꾸민다고 하자.
	- 스위치에 연결된 경우 내가 보낸 패킷이 같은 네트워크의 모든 디바이스가 받아볼 수 있는 것이다.
		- 여러가지 이유로 인해 Class B를 하나의 네트워크로 구성하지 않는다.
			- 네트워크 안에 서브 네트워크를 만드는 것이다.
			- 이를 서브넷이라고 한다.
				- 네트워크 안에서 편리하게 만드는 것이다.

## Subnet
- 서브넷 마스킹
	- 최종 목적지를 선택하기 위해 서브넷 간의 라우팅을 할 방법을 필요로 하고, 따라서 이러한 네트워크를 필요로 한다.
	- 네트워크 외부에서는 모두 동일한 목적지로 작동할 수 있지만, 내부망에서 분리가 되도록 하는 것이다.

- 기본 마스크는 hostid 뒤로 만들게 된다.
	- hostid와 mask가 겹치는 부분을 이용해 처리하게 된다.
		- 여기로 보내주게 된다.

- 내부의 라우터가 데이터를 받았다고 하자.
	- 이걸 어떤 서브넷으로 보낼지 결정해야 하고, 서브넷 마스크를 통해 이를 결정할 수 있는 것이다.
	- mask를 얼마까지 설정해야할 지 결정하는 것이다.
- 수퍼넷이라는 마스크도 있다
	- 클래스 단위가 너무 커서, 이걸 쪼개서 구매하기 위해서 사용한다.
	- 모든 네트워크는 두 단계로 끊어 읽어야 한다.
		- 그 앞의 네트워크 id까지는 동일해야 한다.

### Classless Addressing
- 클래스 자체를 없애버리고, 주소를 할당하도록 하는 것이다.
	- 주소에 대한 클래스는 현재 없는 것은 동잃다'
		- 비트 단위로 끊어질 수 있도록 변형되었다.
- 비트 단위로 쪼개서 사올 수 있다 이제.
	- 이렇게 끊는 것은 Classless 주소라고 한다.
	- 끊어지는거 있으면 Classful 주소라고 한다.

- 헤더의 주소 체계는 바뀌지 않는다.
	- ip는 전 세계에 unique한 주소이다.
	- routing table과 switch가 달라지게 된다.
		- 이를 prefix / suffix라고 한다.
- prefix / suffix 길이 어떻게 측정하는가?
	- 할당되는 주소의 개수에 따라 할당하여 설정할 수 있었다.
	- prefix와 시작 주소가 있어야 네트워크에 자리잡을 수 있다.
		- 같은 네트워크에 속한 디바이스는 prefix가 동일해야 한다.
- slash notation을 통해 클래스 구분 없이 배포할 수 있도록 한다.
	- prefix를 통해 구분할 수 있다.
- 사용하는 ip 개수를 가장 가까운 비트로 보낸 후, 그만큼만 묶어서 빼주면 된다.
	- 32 - 비트의 개수로 처리하면 된다.
- 보편적으로는 큰 네트워크부터 구성한다.
	- 하나의 네트워크를 구성하기 위해서는 prefix가 동일해야 한다.
	- 작은 것 부터 만들면 중간에 비우는 구성이 나올 수 있게 된다.
- 그룹에 따라 서브넷이 존재하고, 각 그룹마다 서브넷이 존재하도록 하는 것이 좋다.
	- 각 블락의 크기가 256이다.
- 그냥 비트 단위로 자르도록 하면 된다.
	- 뒤에서부터 필요한 만큼 자르고 시작하면 된다.
- 사이즈가 다른 서브넷을 구한 후, 이에 대한 추가적인 서브넷이 주어질 때가 가장 어려운 상황이 될 것이다.

## Special Addresses
- IP 주소는 전세계에 하나만 존재한다.
	- 이에 대해 예외가 존재한다.
- 0.0.0.0 -> DHCP 서버에 데이터 보낼 때 사용한다.
	- 유동 ip 사용할 때, DHCP 서버에 모르는 ip를 주소가 있을 때 0.0.0.0으로 할당하게 된다.
	- 거의 대부분 이미 들어봤을 것.
- 255.255.255.255
	- ip 주소에 대한 주소를 써야 한다.
	- limited broadcast를 의미한다.
		- unicast는 1 대 1 connection이다.
		- broadcast는 1 대 all connection이다.
			- 해당되는 내용이 나와 관련되지 않을 수 있지만, 필터링이 더 귀찮아서 이렇게 보낸다.
			- 목적지 모를 때 broadcast로 처리해줄 수 있다.
				- router에서 block 안하면 전 세계로 보내게 되고, router에서 블락할 수 있어야 한다.
			- Directed Broadcast가 있다.
				- 한 네트워크로만 보낸다.
					- 뒤에 있는 suffix 분석한다.
					- 255도 special address러 마제라
		- multicast는 1 대 다를 의미한다.
			- iptv 이런거 쓸 때 많이 쓴다.
			- 인터넷 망을 통해서 라디오 들을 때 앱에서 이렇게 작동한다.
- 127.0.0.1 (loopback)
	- IP주소가 필요하다.
- 유일하지 않은 주소로, 사설망 주소가 있다.
	- 10.0.0.0/8, 192.168.0.0/16, 172.16.0.0/12, 169.254.0.0/16
	- 인터넷으로 나가야 하는 트래픽이 없으면 그냥 네트워크 안 태우고 내부망으로 쓰는게 낫다.
		- 공장같은데는 밖으로 연결 안해도 TCP/IP 가져다 쓰면 된다.
		- 그래도 할당은 해야 해서, 가상 망으로 구축하는 것이다.

### NAT
- 가상망을 만들고, 이를 외부 인터넷과 연결하기 위해서 사용한다.
	- 나갈때는 문제가 없지만, 서버를 통해 요청을 하게 되면 외부망이 문제가 될 수 있다. 
- 내부적으로 이 세팅 하는걸 포트포워딩이라고 한다.